{% extends 'catalogo/base.html' %}

{% block content %}
    <div class="mb-6 overflow-x-auto whitespace-nowrap pb-2 hide-scrollbar">
        <a href="{% url 'lista_produtos' %}" 
           class="inline-block px-5 py-2 rounded-full text-sm font-semibold mr-2 border 
           {% if not categoria_atual %}bg-accent-blue text-white border-accent-blue{% else %}bg-white text-gray-600 border-gray-200{% endif %}">
           Todos
        </a>
        {% for cat in categorias %}
            <a href="?categoria={{ cat.slug }}" 
               class="inline-block px-5 py-2 rounded-full text-sm font-semibold mr-2 border transition-colors
               {% if categoria_atual.slug == cat.slug %}bg-accent-blue text-white border-accent-blue{% else %}bg-white text-gray-600 border-gray-200 hover:bg-gray-50{% endif %}">
               {{ cat.nome }}
            </a>
        {% endfor %}
    </div>
    
    <div class="mb-4 px-1">
        <h2 class="text-2xl font-bold text-primary-text">
            {% if categoria_atual %}{{ categoria_atual.nome }}{% else %}Destaques{% endif %}
        </h2>
    </div>
    
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 pb-24">
        {% for produto in produtos %}
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden flex flex-col h-full relative group">
                
                <a href="{% url 'detalhe_produto' produto.pk %}" class="flex-grow flex flex-col">
                    <div class="relative aspect-[3/4]"> {% if produto.imagem_principal %}
                            <img src="{{ produto.imagem_principal.url }}" 
                                alt="{{ produto.nome }}" 
                                class="w-full h-full object-cover object-top"> {% else %}
                            <div class="w-full h-full bg-gray-100 flex items-center justify-center text-gray-400 text-xs">Sem foto</div>
                        {% endif %}
                    </div>

                    <div class="p-3 flex flex-col flex-grow">
                        <h3 class="text-sm font-medium text-gray-700 line-clamp-2 leading-tight mb-2 min-h-[2.5em]">
                            {{ produto.nome }}
                        </h3>
                        
                        <div class="mt-auto">
                            {% if produto.preco_antigo %}
                                <p class="text-xs text-gray-400 line-through">R$ {{ produto.preco_antigo|floatformat:2 }}</p>
                            {% endif %}
                            
                            <p class="text-lg font-bold text-accent-blue">
                                R$ {{ produto.preco_base|floatformat:2 }}
                            </p>
                        </div>
                    </div>
                </a>

                <div class="px-3 pb-3">
                    <a href="{% url 'detalhe_produto' produto.pk %}" 
                       class="w-full block text-center bg-green-500 hover:bg-green-600 text-white text-sm font-bold py-2 rounded-lg shadow-sm transition-colors">
                        Comprar
                    </a>
                </div>
            </div>
        {% empty %}
            <div class="col-span-full py-10 text-center text-gray-500">
                <p>Nenhum produto encontrado nesta categoria.</p>
                <a href="{% url 'lista_produtos' %}" class="text-accent-blue underline mt-2 block">Ver todos os produtos</a>
            </div>
        {% endfor %}
    </div>

    <style>
        /* Esconde barra de rolagem no menu de categorias */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
{% endblock %}